# Планировщик

## О приложении

Простое приложение для организации напоминаний пользователя. Имеет базовую авторизацию и регистрацию пользователей. Напоминания пользователей хранятся в БД PostgreSQL.

### [Используемые библиотеки](./src-tauri/Cargo.toml)

1. [tauri](https://docs.rs/tauri/1.2.1/tauri/) – основа для создания Tauri приложений.
2. [serde](https://docs.rs/serde/1.0.152/serde/) (serde_json) – самая распространненая библиотека для сериализации и десериализации структур. Поддерживает формат JSON. Используется для передачи структур и объектов между `JS` и `Rust`.
3. [sqlx](https://docs.rs/sqlx/0.6.2/sqlx/) – библиотека для работы с различными БД (PostgreSQL, MySQL, SQLite, MSSQL). Асинхронна, имеет compile-time проверку синтаксиса запросов. Не является ORM. Для работы требуется асинхронный движок (runtime) и какая-нибудь реализация TLS. В рамках этого проекта в качестве асинхронного движка выбран tokio, а для TLS используется библиотека rustls.
4. [tokio](https://docs.rs/tokio/1.24.1/tokio/) – одна из самых распространненных сред асинхронного выполнения. (В стандартной библиотеки `Rust` нет инструментов для асинхронного выполнения кода, они реализованы в виде отдельных библиотек.)
5. [rustls](https://docs.rs/rustls/0.20.8/rustls/) – реализация TLS.
6. [chrono](https://docs.rs/chrono/0.4.19/chrono/) – библиотека для работы с датами и временем. sqlx использует её, чтобы обрабатывать типы данных времени из различных БД.
7. [getset](https://docs.rs/getset/0.1.2/getset/) – автогенерация геттеров и сеттеров для структур.
8. [dotenvy](https://docs.rs/dotenvy/0.15.6/dotenvy/) – простая библиотека для загрузки переменных окружения из файла `.env`.

### UI

Для интерфейса напрямую используется JS, т.е. генерация и удаление объектом DOM происходит вручную.  
Вместо такого подхода можно использовать различные UI фреймворки, например: React, Angular, Next.js и т.д., однако для их поддержки требуется провести дополнительную настройку Tauri. [Подробнее тут (EN)](https://tauri.app/v1/guides/getting-started/setup/next-js).

## Сборка приложения

### Установка необходимых программ

1. Rust

Для начала нужно установить сам `Rust`. В чистом виде он обычно не ставится, вместо него устанавливается инструмент `rustup`, который скачивает определенные версии компилятора языка. Также он умеет переключаться между ними, что бывает удобно, когда нужно воспользоваться нестабильным релизом.  
Помимо самого компилятора языка также будет установлен менеджер пакетов `cargo` (аналог `npm`). Он используется, чтобы добавлять зависимости в проект, собирать его, тестировать, а также публиковать его в виде отдельного пакета (`crate`).  
<b>[Гайд по установке Rust (RU)](https://doc.rust-lang.ru/book/ch01-01-installation.html)</b>.

2. Tauri

Чтобы установить Tauri необходимо выполнить несколько шагов:

2. 1. Установка зависимостей

Tauri необходимы инструменты для сборки проектов и отображения web интерфейса в оконных приложениях. На разных ОС список необходимых компонентов может отличаться.  
<b>[Гайд по установке зависимостей на Windows, Linux и macOS (EN)](https://tauri.app/v1/guides/getting-started/prerequisites)</b>

2. 2. Установка `tauri-cli`

`tauri-cli` – утилита командной строки для управления Tauri-проектами.  
Устанавливается следующей командой:
```sh
$ cargo install tauri-cli
```
С помощью неё выполняется запуск dev-сервера, сборка, генерация иконок и другие функции.

3. sqlx и базы данных

Приложение использует СУБД PostgreSQL. Для работы можно либо <b>[скачать и установить](https://www.postgresql.org/download/)</b> PostgreSQL в свою ОС вместе с сервером БД, либо запустить docker образ с БД PostgreSQL (<b>[гайд по запуску постгреса в докере](https://habr.com/ru/post/578744/)</b>).

sqlx также имеет утилиту для командной строки. Она необходима для управления БД и создания и выполнения миграций.  
Устанавливается следующей командой:
```sh
$ cargo install sqlx-cli
```
Либо же можно установить урезаную и более лёгкую версию специально для работы с PostgreSQL и rustls:
```sh
$ cargo install sqlx-cli --no-default-features --features rustls,postgres
```

### Инициализация БД

В этом примере уже существует несколько тестовых данных для заполнения БД, они находятся в папке [migrations](./src-tauri/migrations/) вместе со всеми миграциями.

Прежде чем собирать приложение, нам надо проинициализировать БД. Это также позволит sqlx динамически проверять правильность составленных в коде программы SQL запросов путём общения с БД.

Для этого нужно перейти в директорию src-tauri и выполнить несколько команд:
```sh
$ cd src-tauri
# задать в переменных окружения ссылку на БД PostgreSQL:
$ export DATABASE_URL="postgres://postgres:password@localhost/todos"
# выполнить инициализацию БД:
$ sqlx db create
# выполнить миграции (отмена миграций выполняется командой sqlx migrate revert):
$ sqlx migrate run
```

### Сборка

Для сборки выполните следующую команду:
```sh
$ cargo tauri build
# или
$ cargo build
```
В результате в папке `./src-tauri/target/release` должен появиться исполняемый файл `tauri-scheduler.exe` с нашим приложением.  
Первая сборка может выполняться долго, поскольку нужно собрать все зависимости. Последующие сборки будут происходить существенно быстрее.

Для отладки используется следующая команда:
```sh
$ cargo tauri dev
# или
$ cargo run
```
Она запускает приложение в режиме отладки, а также разрешает доступ к окну разработчика (F12).

## Полезные расширения для работы с Rust в VS Code

1. [rust-analyzer](https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer) – добавляет поддержку языка Rust (подсветка, дополнения, IntelliSense).
2. [C/C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools) или [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb) – для дебаггинга.